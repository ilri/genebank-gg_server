@ECHO OFF
REM **************************************************************************************************************************
REM **************************************************************************************************************************
REM **************************************************************************************************************************
REM
REM
REM SCRUB DATA FROM DATABASE
REM
REM
REM **************************************************************************************************************************
REM **************************************************************************************************************************
REM **************************************************************************************************************************

REM **************************************************************************************************************************
REM main paths
REM **************************************************************************************************************************
set GG=C:\projects\gringlobal
set NONSVN=C:\projects\gringlobal_non-svn

cd \projects\gringlobal\documentation\release

echo ****************************************************************************
echo ****************************************************************************
echo.
echo Scrubbing unneeded test data from database (lists, settings, etc)
echo.
echo ****************************************************************************
echo ****************************************************************************
for /f %%a IN ('dir /b /s .\sql_scripts\*.sql') do call .\sql_scripts\sqlrunner.bat %%a

echo -------------------------------------------
echo Done scrubbing data
echo -------------------------------------------

REM **************************************************************************************************************************
REM **************************************************************************************************************************
REM **************************************************************************************************************************
REM
REM
REM EXPORT DATA FROM DATABASE
REM
REM
REM **************************************************************************************************************************
REM **************************************************************************************************************************
REM **************************************************************************************************************************
echo ****************************************************************************
echo ****************************************************************************
echo.
echo Exporting schema and data from database to files...
echo.
echo ****************************************************************************
echo ****************************************************************************

del /q /s /f "%NONSVN%\raw_data_files\*.*"

REM ***************************************************************************************************************************
REM Export data from local database to local folder
REM ***************************************************************************************************************************
"%GG%\GrinGlobal.DatabaseCopier\bin\Debug\GrinGlobal.DataBaseCopier.exe" /export "%NONSVN%\raw_data_files" sqlserver "Data Source=localhost\sqlexpress;Initial Catalog=gringlobal;Trusted_Connection=True" gringlobal

REM ***************************************************************************************************************************
REM Copy exported schema to GrinGlobal.DatabaseCopier.Setup so next rebuild pulls it in
REM ***************************************************************************************************************************
copy "%NONSVN%\raw_data_files\__schema.xml" "%GG%\GrinGlobal.Database.Setup\__schema.xml"

echo -------------------------------------------
echo %date% %time% Done exporting data.
echo -------------------------------------------
pause